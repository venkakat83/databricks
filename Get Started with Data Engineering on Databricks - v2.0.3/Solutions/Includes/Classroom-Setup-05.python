{"version":"NotebookV1","origId":2730474723967862,"name":"Classroom-Setup-05","language":"python","commands":[{"version":"CommandV1","origId":2730474723967863,"guid":"94bee739-8518-4251-84e4-97350b6c90ac","subtype":"command","commandType":"auto","position":2.0,"command":"%run ../Includes/_common","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"374bb022-9aa3-419d-bd12-76dc0b7e9a63"},{"version":"CommandV1","origId":2730474723967864,"guid":"a5477530-2bba-4f93-a16c-aa0dfa9c09cb","subtype":"command","commandType":"auto","position":3.0,"command":"# lesson: Writing delta \ndef _create_eltwss_users_update():\n    import time\n    import pyspark.sql.functions as F\n    start = int(time.time())\n    print(f\"\\nCreating the table \\\"customers_dirty\\\"\", end=\"...\")\n\n    df = spark.createDataFrame(data=[(None, None, None, None), (None, None, None, None), (None, None, None, None)], \n                               schema=\"user_id: string, user_first_touch_timestamp: long, email:string, updated:timestamp\")\n    (spark.read\n          .load(f\"{DA.paths.datasets}/customers_delta\")\n          .withColumn(\"updated\", F.current_timestamp())\n          \n          .write\n          .mode(\"overwrite\")\n          .saveAsTable(\"customers_dirty\"))\n    \n    total = spark.read.table(\"customers_dirty\").count()\n    print(f\"({int(time.time())-start} seconds / {total:,} records)\")","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"eced9798-f8fe-4592-b440-2884e8c16219"},{"version":"CommandV1","origId":2730474723967865,"guid":"fbaa4b47-2488-4419-a294-7e611f2b8d29","subtype":"command","commandType":"auto","position":4.0,"command":"# lesson_config = LessonConfig(name = None,\n#                              create_schema = True,\n#                              create_catalog = False,\n#                              requires_uc = False,\n#                              installing_datasets = True,\n#                              enable_streaming_support = False,\n#                              enable_ml_support = False)\n\nDA = DBAcademyHelper(course_config=course_config,\n                     lesson_config=lesson_config)\nDA.reset_lesson()\nDA.init()\n\n# _create_eltwss_users_update()\n    \nDA.conclude_setup()\n","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"3d7b72a5-cba7-406b-9a46-2170911681ca"}],"dashboards":[],"guid":"61f822ab-86b1-45df-b8e2-e85c6fdd39d5","globalVars":{},"iPythonMetadata":null,"inputWidgets":{},"notebookMetadata":{},"reposExportFormat":"SOURCE"}